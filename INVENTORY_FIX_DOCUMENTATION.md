# ๐ ุฅุตูุงุญ ูุธุงู ุงูุฌุฑุฏ ูุงููุฒุงููุฉ ูุน Firebase

## ๐ง ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. **ูุดููุฉ ุญุณุงุจ ุงูุฌุฑุฏ (Inventory Count)**

#### โ **ุงููุดููุฉ ุงูุฃุตููุฉ:**
- ูุงูุช ูุนุงุฏูุฉ ุญุณุงุจ ุงููุฎุฒูู ุบูุฑ ุตุญูุญุฉ ูู ูุนุงููุงุช ุงูุจูุน ูุงูุดุฑุงุก
- ูุงู `inventoryCount` ูุชู ุชุญุฏูุซู ูุจุงุดุฑุฉ ูุน ูู ูุนุงููุฉ:
  ```
  // ุฎุทุฃ โ
  if (sale) {
    inventoryCount -= quantity
  } else if (purchase) {
    inventoryCount += quantity
  }
  ```

#### โ **ุงูุญู ุงูุตุญูุญ:**
ุงูุฌุฑุฏ (ุงููุฎุฒูู) ูุฌุจ ุฃู ูููู ุนุจุงุฑุฉ ุนู ูููุงุณูู ูููุตููู:

**1. ุงููุฎุฒูู ุงููุธุฑู (currentStock):**
```
currentStock = openingStock + purchases - issues
```
ุญูุซ:
- `openingStock`: ุงููุฎุฒูู ุงูุงุจุชุฏุงุฆู
- `purchases`: ุฅุฌูุงูู ุงููุดุชุฑูุงุช
- `issues`: ุฅุฌูุงูู ุงูุตุฑููุงุช/ุงููุจูุนุงุช

**2. ุงูุฌุฑุฏ ุงูููุฒูุงุฆู (inventoryCount):**
- ูุฐุง ุฑูู ูุชู ุฅุฏุฎุงูู ูุฏููุงู ูู ูุจู ุงููุณุชุฎุฏู ุนูุฏ ุนูู ุฌุฑุฏ ูุนูู
- ูุง ูุชุบูุฑ ุชููุงุฆูุงู ูุน ุงููุนุงููุงุช
- ููุณุชุฎุฏู ูุญุณุงุจ ุงููุฑู (difference) = currentStock - inventoryCount

## ๐ ุงููููุงุช ุงูุชู ุชู ุชุนุฏูููุง

### 1. **lib/storage.ts**
โ ุชู ุฅุตูุงุญ ุฏุงูุฉ `addTransaction` ููุชููู ุนู ุชุญุฏูุซ `inventoryCount` ุชููุงุฆูุงู

```typescript
// ูุจู (ุฎุทุฃ) โ
case "sale":
  product.issues = (product.issues || 0) + transaction.quantity
  product.inventoryCount = (product.inventoryCount || 0) - transaction.quantity

// ุจุนุฏ (ุตุญูุญ) โ
case "sale":
  product.issues = (product.issues || 0) + transaction.quantity
  // ูุง ูุญุฏุซ inventoryCount ููุง
```

โ ุชู ุฅุตูุงุญ ุฏุงูุฉ `addAdjustment` ูุนุฏู ุชุบููุฑ `openingStock` ุชููุงุฆูุงู

### 2. **app/fix-inventory/page.tsx**
โ ุชู ุฅุถุงูุฉ ุฎุงุตูุฉ ูุฒุงููุฉ Firebase
- ูุชู ุชุญุฏูุซ `currentStock` ููุฌููุน ุจูุงุกู ุนูู ุงูุตูุบุฉ ุงูุตุญูุญุฉ
- ูุชู ุฑูุน ุงูุจูุงูุงุช ุชููุงุฆูุงู ุฅูู Firebase ุจุนุฏ ุงูุชุญุฏูุซ ุงููุญูู

### 3. **lib/firebase-sync-engine.ts** โ
- ูุนูู ุจุดูู ุตุญูุญ
- ูุฏุนู ูุฒุงููุฉ ุฌูุงุนูุฉ ูู ุฎูุงู ุฏุงูุฉ `syncProductsBatch`
- ูุนูุฏ ูุญุงููุฉ ุงูุฑูุน ุชููุงุฆูุงู ูู ุญุงูุฉ ุงููุดู

## ๐ ููููุฉ ุงุณุชุฎุฏุงู ุงูุฅุตูุงุญ

### ุงูุทุฑููุฉ ุงูุฃููู: ุตูุญุฉ ุงูููุจ
1. ุงุฐูุจ ุฅูู: `/fix-inventory`
2. ุงุถุบุท "ุงุจุฏุฃ ุงูุฅุตูุงุญ ูุงูุฑูุน"
3. ุณูุชู ุชุญุฏูุซ ุฌููุน ุงูููุชุฌุงุช ูุฑูุนูุง ุฅูู Firebase

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: Console Script
```javascript
// ูู ูุชุตูุญ ุงูููุจ:
const { fixInventoryAndSync } = await import('/fix-inventory-and-sync.ts');
await fixInventoryAndSync();
```

## ๐ ูุนุงุฏูุงุช ุงูุญุณุงุจ

### ูุซุงู ุนููู:

**ููุชุฌ: ูุฑุณู ููุชุจ**
- ุงููุฎุฒูู ุงูุงุจุชุฏุงุฆู: 20
- ุงููุดุชุฑูุงุช: 10
- ุงููุตุฑููุงุช (ูุจูุนุงุช): 8
- ุงูุฌุฑุฏ ุงูููุฒูุงุฆู (ูุง ุชู ุนุฏู ูุนูุงู): 22

```
currentStock = 20 + 10 - 8 = 22 โ
difference = 22 - 22 = 0 (ูุง ุชูุฌุฏ ูุฑููุงุช)
```

**ูุซุงู ุขุฎุฑ (ูุน ูุฑู):**
- ุงููุฎุฒูู ุงูุงุจุชุฏุงุฆู: 20
- ุงููุดุชุฑูุงุช: 10
- ุงููุตุฑููุงุช: 8
- ุงูุฌุฑุฏ ุงูููุฒูุงุฆู: 20

```
currentStock = 20 + 10 - 8 = 22 (ูุธุฑู)
difference = 22 - 20 = 2 (ุนุฌุฒ: ูุงูุต ูุทุนุชูู)
```

## ๐ ุชุฏูู ุงูุจูุงูุงุช

```
ุงููุณุชุฎุฏู ูุฏุฎู ูุนุงููุฉ (ุดุฑุงุก/ุจูุน)
        โ
ุชุญุฏูุซ (purchases) ุฃู (issues)
        โ
ุฅุนุงุฏุฉ ุญุณุงุจ currentStock = opening + purchases - issues
        โ
ุญูุธ ูู IndexedDB ูุญููุงู
        โ
ุฑูุน ุชููุงุฆู ุฅูู Firebase
        โ
โ ูุฒุงููุฉ ูุงููุฉ
```

## ๐ ููุงุญุธุงุช ูููุฉ

### โ ูุง ุงูุฐู ุชู ุฅุตูุงุญู:
1. ูุนุงุฏูุฉ ุงูุฌุฑุฏ ุงูุตุญูุญุฉ
2. ุนุฏู ุชุญุฏูุซ inventoryCount ุชููุงุฆูุงู ูุน ุงููุนุงููุงุช
3. ูุฒุงููุฉ Firebase ุจุนุฏ ุงูุฅุตูุงุญ
4. ุญุณุงุจ ุงููุฑููุงุช ุงูุตุญูุญ

### โ๏ธ ูุง ูุฌุจ ุงูุงูุชุจุงู ูู:
1. **Inventory Count** ูู ููุงุณ ูุฏูู ููุท
   - ูุชู ุฅุฏุฎุงูู ูู ุตูุญุฉ ุงูุฌุฑุฏ
   - ูุฌุจ ุฃู ูุนูุณ ุงูุฌุฑุฏ ุงููุนูู ูู ุงููุณุชูุฏุน

2. **Current Stock** ูู ููุงุณ ูุธุฑู
   - ููุญุณุจ ุชููุงุฆูุงู ูู: opening + purchases - issues
   - ูุง ูููู ุชุญุฑูุฑู ูุจุงุดุฑุฉ ูู ุงููููุฐุฌ

3. **Difference** = Current Stock - Inventory Count
   - ูุธูุฑ ุงููุฑููุงุช ุจูู ุงููุธุฑู ูุงููุนูู
   - ูุฏ ูุดูุฑ ุฅูู ุฃุฎุทุงุก ุฃู ุณุฑูุงุช ุฃู ุฃุฎุทุงุก ุฅุฏุฎุงู

## ๐ ุงูููุงุฆุฏ

โ **ุฏูุฉ ุฃูุถู:** ุญุณุงุจ ุตุญูุญ ูููุฎุฒูู ุงููุธุฑู
โ **ุชุชุจุน ุฃูุถู:** ูุนุฑูุฉ ุงููุฑููุงุช ุจูู ุงููุธุฑู ูุงููุนูู
โ **ูุฒุงููุฉ ุขููุฉ:** ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ูู Firebase
โ **ุณูููุฉ ุงูุงุณุชุฎุฏุงู:** ูุง ุญุงุฌุฉ ููููู ุจุดุฃู ุงููุฒุงููุฉ ุงููุฏููุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ุชุญุฏุซ ุงููุฒุงููุฉ:
1. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
2. ุงูุชุญ Firebase Console ูุชุญูู ูู ุงูุตูุงุญูุงุช
3. ุฌุฑุจ ุฒุฑ "ุฑูุน" ูู ุงูุฒุงููุฉ ุงูุณูููุฉ ุงููุณุฑู

### ุฅุฐุง ุธูุฑุช ุฃุฑูุงู ุฎุงุทุฆุฉ:
1. ุงุฐูุจ ุฅูู `/fix-inventory` ูุดุบู ุงูุฅุตูุงุญ ูุฑุฉ ุฃุฎุฑู
2. ุชุญูู ูู ุฃู ุงููุดุชุฑูุงุช ูุงูุตุฑููุงุช ูุญููุธุฉ ุจุดูู ุตุญูุญ

## ๐ ุงูุฏุนู

ูุฃู ูุดููุฉุ ุชุญูู ูู:
- Browser Console (F12)
- Firebase Console logs
- Application โ IndexedDB โ Products
